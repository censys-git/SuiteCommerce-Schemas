{
  "$id": "https://example.com/suitecommerce-manifest.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SuiteCommerce Extension Manifest",
  "type": "object",
  "additionalProperties": true,

  "definitions": {
    "fileList": { "type": "array", "items": { "type": "string" } },
    "nonEmptyFileList": { "type": "array", "minItems": 1, "items": { "type": "string" } },

    "entryPoints": {
      "type": "object",
      "additionalProperties": { "type": "string" }
    },
    "nonEmptyEntryPoints": {
      "type": "object",
      "minProperties": 1,
      "additionalProperties": { "type": "string" },
      "properties": {
        "shopping": { "type": "string" },
        "checkout": { "type": "string" },
        "myaccount": { "type": "string" }
      }
    },

    "appBucket": {
      "type": "object",
      "properties": { "files": { "$ref": "#/definitions/nonEmptyFileList" } },
      "required": ["files"],
      "additionalProperties": true
    },

    "appSectionNonEmpty": {
      "type": "object",
      "properties": {
        "shopping": { "$ref": "#/definitions/appBucket" },
        "checkout": { "$ref": "#/definitions/appBucket" },
        "myaccount": { "$ref": "#/definitions/appBucket" }
      },
      "additionalProperties": true,
      "anyOf": [
        { "required": ["shopping"] },
        { "required": ["checkout"] },
        { "required": ["myaccount"] }
      ]
    }
  },

  "properties": {
    "name": { "type": "string" },
    "fantasyName": { "type": "string" },
    "vendor": { "type": "string" },
    "version": { "type": "string" },
    "type": { "type": "string", "enum": ["extension", "theme"] },
    "target": { "type": "string", "enum": ["SCA", "SCS", "SCA,SCS"] },
    "target_version": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "properties": { "SCA": { "type": "string" }, "SCS": { "type": "string" } }
    },
    "description": { "type": "string" },
    "skins": { "type": "array", "items": { "type": "string" } },

    "assets": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "properties": { "files": { "$ref": "#/definitions/fileList" } },
        "required": ["files"],
        "additionalProperties": true
      }
    },

    "configuration": {
      "type": "object",
      "properties": { "files": { "$ref": "#/definitions/fileList" } },
      "required": ["files"],
      "additionalProperties": true
    },

    "sass": {
      "type": "object",
      "properties": {
        "entry_points": { "$ref": "#/definitions/entryPoints" },
        "files": { "$ref": "#/definitions/fileList" }
      },
      "additionalProperties": true
    },

    "templates": {
      "type": "object",
      "properties": {
        "application": { "$ref": "#/definitions/appSectionNonEmpty" }
      },
      "additionalProperties": true
    },

    "javascript": {
      "type": "object",
      "properties": {
        "entry_points": { "$ref": "#/definitions/entryPoints" },
        "application": { "$ref": "#/definitions/appSectionNonEmpty" }
      },
      "additionalProperties": true
    },

    "local_folder": { "type": "string" }
  },

  "required": ["name", "vendor", "version", "type", "target"],

  "anyOf": [
    { "required": ["sass"] },
    { "required": ["javascript"] },
    { "required": ["templates"] }
  ],

  "allOf": [
    {
      "if": { "required": ["javascript"] },
      "then": {
        "properties": {
          "javascript": {
            "allOf": [
              { "properties": { "entry_points": { "$ref": "#/definitions/nonEmptyEntryPoints" } } },
              { "properties": { "application": { "$ref": "#/definitions/appSectionNonEmpty" } } }
            ],
            "required": ["entry_points", "application"]
          }
        }
      }
    },
    {
      "if": { "required": ["sass"] },
      "then": {
        "properties": {
          "sass": {
            "allOf": [
              { "properties": { "entry_points": { "$ref": "#/definitions/nonEmptyEntryPoints" } } },
              { "properties": { "files": { "$ref": "#/definitions/nonEmptyFileList" } } }
            ],
            "required": ["entry_points", "files"]
          }
        }
      }
    },
    {
      "if": { "required": ["templates"] },
      "then": {
        "properties": {
          "templates": {
            "properties": {
              "application": { "$ref": "#/definitions/appSectionNonEmpty" }
            },
            "required": ["application"]
          }
        }
      }
    }
  ]
}
